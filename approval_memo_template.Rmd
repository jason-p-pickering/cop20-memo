---
title: "COP20 Approval Memo"
date: "`r paste0('Generated on ' , format(Sys.time(), '%Y-%m-%d'))`"
output:
  html_document:
    toc: no
    df_print: paged
  pdf_document:
    toc: no
    latex_engine: xelatex
header-includes:
- \usepackage{tabularx,booktabs}
- \usepackage{multirow}
- \usepackage{float}
- \usepackage{xcolor}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{fancyhdr}
classoption: landscape
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(kableExtra.latex.load_packages = FALSE)
```

\addtolength{\headheight}{0.1cm}
\pagestyle{fancyplain}
```{r header_name ,results='asis', echo=FALSE}
ou_name<-getOrgtuniNamefromUID(input$ou)
cat(paste("\\rhead{COP20 Approval Memo (",ou_name,") }"))
```
\renewcommand{\headrulewidth}{0pt}


```{r prio_table ,results='asis', echo=FALSE}
if (!exists("d")) {
  d <- memo_data()
}

kable(d$prio, "latex", booktabs = T,format.args = list(big.mark = ","), longtable = T) %>%
  column_spec(1,width = "1.2in",bold=TRUE) %>%
  column_spec(2,width = "0.25in") %>% 
  column_spec(3:9, width = "0.6in") %>% 
  collapse_rows(columns = 1, latex_hline = "major", valign = "middle") %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header"))

  cat('\n\n')
  cat('\\pagebreak')
  cat('\n\n')
  
```



```{r partner_table ,results='asis', echo=FALSE}



sub_heading<-names(d$partners)[3:length(d$partners)] %>% stringr::str_split(.," ") %>% purrr::map(purrr::pluck(2)) %>%
  unlist()


group_heading<-names(d$partners)[3:length(d$partners)] %>% stringr::str_split(.," ") %>% purrr::map(purrr::pluck(1)) %>% 
  unlist() %>% 
  factor(.,levels = unique(.)) %>%
  table(.)


#HTS_INDEX -> TX_PVLS
kable(d$partners[,c(1:14)], "latex", booktabs = T,format.args = list(big.mark = ","),
      col.names = c("Funding Agency","Partner",sub_heading[1:12])) %>%
  kable_styling(font_size = 6) %>% 
  column_spec(2,width = "1in") %>% 
  column_spec(3:14,width = "0.33in") %>% 
  add_header_above(c("","",group_heading[1:6])) %>% 
  row_spec(which(d$partners$Partner == ""),background = "lightgray")

 cat('\n\n')
  cat('\\pagebreak')
  cat('\n\n')
  
#CXCA_>PMTCT_EID
kable(d$partners[,c(1:2,15:25)], "latex", booktabs = T,format.args = list(big.mark = ","),
      col.names = c("Funding Agency","Partner",sub_heading[13:23])) %>%
  kable_styling(font_size = 6) %>% 
  column_spec(2,width = "1in") %>% 
  column_spec(3:10,width = "0.33in") %>% 
  add_header_above(c("","",group_heading[7:13])) %>% 
  row_spec(which(d$partners$Partner == ""),background = "lightgray")

 cat('\n\n')
  cat('\\pagebreak')
  cat('\n\n')
  
  
#PP_PREV-> Prep_CURR
kable(d$partners[,c(1:2,26:35)], "latex", booktabs = T,format.args = list(big.mark = ","),
      col.names = c("Funding Agency","Partner",sub_heading[24:33])) %>%
  kable_styling(font_size = 6) %>% 
  column_spec(2,width = "1in") %>% 
  column_spec(3:10,width = "0.33in") %>% 
  add_header_above(c("","",group_heading[14:20])) %>% 
  row_spec(which(d$partners$Partner == ""),background = "lightgray")

 cat('\n\n')
  cat('\\pagebreak')
  cat('\n\n')
  
  #TB_STAT->OVC_HIV_STAT
  kable(d$partners[,c(1:2,36:44)], "latex", booktabs = T,format.args = list(big.mark = ","),
      col.names = c("Funding Agency","Partner",sub_heading[34:42])) %>%
  kable_styling(font_size = 6) %>% 
  column_spec(2,width = "1in") %>% 
  column_spec(3:10,width = "0.33in") %>% 
  add_header_above(c("","",group_heading[21:25])) %>% 
  row_spec(which(d$partners$Partner == ""),background = "lightgray")

 cat('\n\n')
  cat('\\pagebreak')
  cat('\n\n')
  
  
```



